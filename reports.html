<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تقرير قياسات الجلوكوز</title>
  <link rel="stylesheet" href="./css/reports.css" />
  <!-- PDF فقط للتصدير (خفيف) -->
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js" defer></script>
</head>
<body>
  <div class="wrap">

    <!-- شريط علوي -->
    <div class="topbar">
      <div class="chips" id="childChips"></div>
      <div class="zoom">
        <label for="printZoom">تكبير الطباعة</label>
        <input id="printZoom" type="range" min="0.8" max="1.3" step="0.02" value="1" />
      </div>
    </div>

    <!-- أدوات -->
    <div class="toolbar sheet">
      <div class="range">
        <div class="field">
          <span>من</span>
          <input type="date" id="fromDate">
        </div>
        <div class="field">
          <span>إلى</span>
          <input type="date" id="toDate">
        </div>
        <div class="quick-range">
          <button class="btn chip" data-days="7">7 أيام</button>
          <button class="btn chip" data-days="14">14</button>
          <button class="btn chip" data-days="30">30</button>
          <button class="btn chip" data-days="90">90</button>
        </div>
      </div>

      <div class="chk">
        <input type="checkbox" id="chkShowNotes" checked />
        <label for="chkShowNotes">إظهار الملاحظات/الجرعات</label>
      </div>

      <div class="actions">
        <button id="btnShow" class="btn">عرض</button>
        <button id="btnBack" class="btn btn--ghost">رجوع</button>
        <button id="btnBlankWeek" class="btn btn--danger">ورقة فارغة (7 أيام)</button>
        <button id="btnPrintPage" class="btn btn--warn">صفحة طباعة التقرير</button>
        <button id="btnAnalytics" class="btn btn--ok">التحاليل</button>
        <button id="btnPrint" class="btn">طباعة</button>
        <button id="btnExportPDF" class="btn">PDF ⬇</button>
        <button id="btnExportCSV" class="btn">CSV ⬇</button>
        <button id="btnExportXLSX" class="btn">Excel ⬇</button>
      </div>
    </div>

    <!-- نظرة عامة -->
    <div class="sheet">
      <div class="line">
        <strong id="childName">—</strong>
        <span class="muted" id="childMeta"></span>
      </div>
      <div class="line">
        الفترة: <b id="periodFrom">—</b> إلى <b id="periodTo">—</b>
      </div>
    </div>

    <!-- إحصائيات -->
    <div class="stats-bar">
      <div class="cards">
        <div class="card"><div class="k">TIR</div><div id="stTIR">0%</div></div>
        <div class="card"><div class="k">Avg</div><div id="stAvg">0</div></div>
        <div class="card"><div class="k">SD</div><div id="stSD">0</div></div>
        <div class="card"><div class="k">CV%</div><div id="stCV">0%</div></div>
        <div class="card low"><div class="k">Lows</div><div id="stLow">0</div></div>
        <div class="card high"><div class="k">Highs</div><div id="stHigh">0</div></div>
        <div class="card crit"><div class="k">Critical</div><div id="stCrit">0</div></div>
      </div>
      <div class="spark" id="spark"></div>
    </div>

    <!-- Views -->
    <div class="view" id="view-report">
      <div id="reportRoot" class="report-wrapper sheet">
        <div class="report-scroll">
          <table id="reportTable" class="report-table">
            <thead id="tblHead"></thead>
            <tbody id="tblBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ورقة 7 أيام فارغة -->
    <div class="view hidden" id="view-blank-week">
      <div class="blank-sheet">
        <h3 class="section-title">ورقة متابعة (٧ أيام)</h3>
        <div class="chips" style="margin:6px 0">
          <span class="chip">الطفل: <b id="bkChildName">—</b></span>
          <span class="chip">الوحدة: <b id="bkUnit">—</b></span>
          <span class="chip">CR: <b id="bkCR">—</b></span>
          <span class="chip">CF: <b id="bkCF">—</b></span>
          <span class="chip">من: <b id="bkFrom">—</b></span>
          <span class="chip">إلى: <b id="bkTo">—</b></span>
        </div>

        <div class="section-title">شبكة القياسات</div>
        <div id="bkGrid" class="blank-grid"></div>

        <div class="section-title">ملاحظات / الوجبات / جرعات التصحيح</div>
        <div id="bkNotesGrid" class="blank-notes-grid"></div>
      </div>
    </div>

    <div class="toast" id="toast" style="display:none"></div>
  </div>

  <!-- Firebase config (ESM يصدر auth/db) -->
  <script type="module" src="./js/reports.js"></script>
</body>
</html>
