<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تقرير قياسات الجلوكوز</title>
  <link rel="stylesheet" href="./css/reports.css" />
  <!-- PDF فقط للتصدير (خفيف) -->
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js" defer></script>
</head>
<body>
  <div class="wrap">

    <!-- شريط علوي -->
    <div class="topbar">
      <div class="chips" id="childChips"></div>

      <div class="period">
        <label>من</label><input type="date" id="fromDate">
        <label>إلى</label><input type="date" id="toDate">
        <button id="q7" class="chip">٧ أيام</button>
        <button id="q14" class="chip">١٤ يوم</button>
        <button id="q30" class="chip">٣٠ يوم</button>
      </div>

      <div class="chk">
        <input type="checkbox" id="chkShowNotes" checked />
        <label for="chkShowNotes">إظهار الملاحظات/الجرعات</label>
      </div>

      <div class="actions">
        <button id="btnShow" class="btn">عرض</button>
        <button id="btnBack" class="btn btn--ghost">رجوع</button>
        <button id="btnBlankWeek" class="btn btn--danger">ورقة فارغة (7 أيام)</button>
        <button id="btnPrintPage" class="btn btn--warn">صفحة طباعة التقرير</button>
        <button id="btnAnalytics" class="btn btn--ok">التحاليل</button>
        <button id="btnPrint" class="btn">طباعة</button>
        <button id="btnExportPDF" class="btn">PDF ⬇</button>
        <button id="btnExportCSV" class="btn">CSV ⬇</button>
        <button id="btnExportXLSX" class="btn">Excel ⬇</button>
      </div>
    </div>

    <!-- نظرة عامة -->
    <div class="sheet">
      <div class="line">
        <strong id="childName">—</strong>
        <span class="muted" id="childMeta"></span>
      </div>
      <div class="line">
        الفترة: <b id="periodFrom">—</b> إلى <b id="periodTo">—</b>
      </div>
    </div>

    <!-- لوحة التحليلات الذكية -->
    <div class="sheet">
      <div id="aiPanel" class="panel">
        <h3 class="section-title">تحليلات ذكية</h3>
        <div class="kpis">
          <div class="kpi"><div class="kpi-label">TIR</div><div class="kpi-val" id="stTIR">—</div></div>
          <div class="kpi"><div class="kpi-label">المتوسط</div><div class="kpi-val"><span id="stAvg">—</span></div></div>
          <div class="kpi"><div class="kpi-label">SD</div><div class="kpi-val" id="stSD">—</div></div>
          <div class="kpi"><div class="kpi-label">CV</div><div class="kpi-val" id="stCV">—</div></div>
          <div class="kpi"><div class="kpi-label">Lows</div><div class="kpi-val" id="stLow">—</div></div>
          <div class="kpi"><div class="kpi-label">Highs</div><div class="kpi-val" id="stHigh">—</div></div>
          <div class="kpi"><div class="kpi-label">حرجة</div><div class="kpi-val" id="stCrit">—</div></div>
          <div class="kpi"><div class="kpi-label">Trend</div><div class="kpi-val"><span id="spark"></span></div></div>
        </div>
        <ul id="aiList" class="insights"></ul>
      </div>
    </div>

    <!-- العرض الرئيسي -->
    <div class="view" id="view-default">
      <div class="sheet">
        <div class="table-wrap" id="reportRoot">
          <table class="table" id="reportTable">
            <thead id="tblHead"></thead>
            <tbody id="tblBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ورقة 7 أيام فارغة -->
    <div class="view hidden" id="view-blank-week">
      <div class="blank-sheet">
        <h3 class="section-title">ورقة متابعة (٧ أيام)</h3>
        <div class="chips" style="margin:6px 0">
          <span class="chip">الطفل: <b id="bkChildName">—</b></span>
          <span class="chip">الوحدة: <b id="bkUnit">—</b></span>
          <span class="chip">CR: <b id="bkCR">—</b></span>
          <span class="chip">CF: <b id="bkCF">—</b></span>
          <span class="chip">من: <b id="bkFrom">—</b></span>
          <span class="chip">إلى: <b id="bkTo">—</b></span>
        </div>

        <div class="section-title">شبكة القياسات</div>
        <div id="bkGrid" class="blank-grid"></div>

        <div class="section-title">ملاحظات / الوجبات / جرعات التصحيح</div>
        <div id="bkNotesGrid" class="blank-notes-grid"></div>
      </div>
    </div>

    <div class="toast" id="toast" style="display:none"></div>
  </div>

  <!-- Firebase config (ESM يصدر auth/db) -->
  <script type="module" src="./js/reports.js"></script>
</body>
</html>
