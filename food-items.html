<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>مكتبة الأصناف</title>
  <link rel="stylesheet" href="css/food-items.css"/>

  <!-- SheetJS (لازم قبل كودنا) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Firebase (Modular) -->
  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // لو عندك ملف config خارجي، ممكن تمسح البلوك ده وتحافظ على القديم
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // نزود app/global db على window علشان كودنا الرئيسي يستخدمه
    const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
    window.db = getFirestore(app);
  </script>
</head>
<body>

  <header class="topbar">
    <div class="left">
      <button id="btnLogout" class="btn btn--ghost">خروج</button>
      <span id="userEmail" class="muted"></span>
    </div>
    <div class="right">
      <button id="btnAdd" class="btn">إضافة صنف</button>
      <input id="excelFile" type="file" accept=".xlsx,.xls" hidden />
      <button id="btnImport" class="btn btn--ghost">استيراد من Excel</button>
      <button id="btnExport" class="btn btn--ghost">تصدير إلى Excel</button>
    </div>
  </header>

  <section class="toolbar">
    <label><input type="checkbox" id="activeOnly" checked/> نشط فقط</label>
    <select id="categoryFilter">
      <option value="">(الكل)</option>
      <option>النشويات</option>
      <option>منتجات الحليب</option>
      <option>الفاكهة</option>
      <option>الخضروات</option>
      <option>منتجات اللحوم</option>
      <option>الدهون</option>
      <option>الحلويات</option>
      <option>اخرى</option>
    </select>
    <input id="searchBox" class="search" placeholder="بحث بالاسم/الوصف/الوسوم"/>
  </section>

  <main id="cards" class="grid"></main>

  <!-- محرّر الصنف -->
  <dialog id="dlg">
    <form method="dialog" id="itemForm">
      <div class="dlg-header">
        <h3 id="dlgTitle">إضافة صنف</h3>
        <button type="button" id="btnClose" class="btn btn--ghost">إغلاق</button>
      </div>

      <div class="row">
        <div class="col">
          <label>الاسم (AR)</label>
          <input id="name_ar" required/>
        </div>
        <div class="col">
          <label>الفئة</label>
          <select id="category_in">
            <option>النشويات</option>
            <option>منتجات الحليب</option>
            <option>الفاكهة</option>
            <option>الخضروات</option>
            <option>منتجات اللحوم</option>
            <option>الدهون</option>
            <option>الحلويات</option>
            <option>اخرى</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>وصف (AR)</label>
          <input id="desc_ar" placeholder="وصف مختصر"/>
        </div>
        <div class="col">
          <label>رابط صورة</label>
          <input id="imageUrl" placeholder="https://..."/>
        </div>
      </div>

      <div class="row">
        <div class="col"><label>GI</label><input id="gi" type="number" step="1" placeholder="مثال: 50"/></div>
        <div class="col"><label>السعرات (kcal) لكل 100g</label><input id="cal_kcal" type="number" step="0.1"/></div>
      </div>

      <div class="row">
        <div class="col"><label>الكارب (g)</label><input id="carbs_g" type="number" step="0.1"/></div>
        <div class="col"><label>البروتين (g)</label><input id="protein_g" type="number" step="0.1"/></div>
      </div>

      <div class="row">
        <div class="col"><label>الدهون (g)</label><input id="fat_g" type="number" step="0.1"/></div>
        <div class="col"><label>الصوديوم (mg)</label><input id="sodium_mg" type="number" step="1"/></div>
      </div>

      <div class="row">
        <div class="col">
          <label>المقادير البيّنة (قياس/وحدة)</label>
          <input id="measureName" placeholder="مثال: رغيف، كوب"/>
        </div>
        <div class="col">
          <label>الجرام المكافئ</label>
          <input id="measureGrams" type="number" step="1" placeholder="مثال: 120"/>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>dietTags (EN, comma)</label>
          <input id="dietTags" placeholder="keto, low-carb, low-gi"/>
        </div>
        <div class="col">
          <label>Tags# (AR, comma)</label>
          <input id="tags" placeholder="سناك, فطور, منخفض_الكارب"/>
        </div>
      </div>

      <div class="row between">
        <div class="col">
          <button id="btnAutoSuggest" type="button" class="btn btn--ghost">توليد تلقائي (من القيم)</button>
          <label class="switch">
            <input type="checkbox" id="autoOnChange" checked/>
            <span>حدّث تلقائيًا</span>
          </label>
        </div>
        <label class="col right">
          <input type="checkbox" id="isActive" checked/> نشط
        </label>
      </div>

      <div id="aiNotes" class="muted"></div>

      <div class="row end">
        <button id="btnSave" class="btn" value="default">حفظ</button>
      </div>
    </form>
  </dialog>

  <script type="module" src="js/food-items.js"></script>
</body>
</html>
