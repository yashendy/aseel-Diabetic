<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠØ©</title>
  <link rel="icon" href="data:,">
  <style>
    :root{--border:#cfd8e3}
    *{box-sizing:border-box}
    body{margin:0;background:#F0F8FF;color:#222;font-family:'Segoe UI',Tahoma,Arial,sans-serif}
    .container{max-width:900px;margin:auto;padding:16px}
    .top{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .btn{border:1px solid #cfe1ff;background:#E3F2FD;color:#0D47A1;border-radius:10px;padding:8px 14px;cursor:pointer}
    .card{background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 6px 16px rgba(0,0,0,.06);margin-top:12px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border:1px solid var(--border);padding:8px;text-align:right}
    th{background:#f7fbff}
    input{width:100%;padding:8px;border:1px solid #cfd8e3;border-radius:10px}
    .meta{color:#555;margin:6px 0}
    @media print {.no-print{display:none} body{background:white}}
  </style>
</head>
<body>
  <div class="container">
    <div class="top no-print">
      <button class="btn" onclick="history.back()">â¬… Ø±Ø¬ÙˆØ¹</button>
      <h1>ğŸ”¬ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠØ©</h1>
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>

    <div class="meta">
      Ø§Ù„Ø·ÙÙ„: <b id="childName">â€”</b> â€¢ Ø§Ù„ØªØ§Ø±ÙŠØ®: <input id="labDate" type="date" style="width:auto">
    </div>

    <div class="card">
      <h3>HbA1c</h3>
      <table>
        <tr><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr>
        <tr>
          <td><input id="hba1cVal" placeholder="%"></td>
          <td>%</td>
          <td><input id="hba1cNote" placeholder="ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø·Ø¨ÙŠØ¨ / Ø§Ù„Ù‡Ø¯Ù"></td>
        </tr>
      </table>
    </div>

    <div class="card">
      <h3>Lipid Profile</h3>
      <table>
        <tr><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr>
        <tr><td>TC</td><td><input></td><td>mg/dL</td><td><input></td></tr>
        <tr><td>LDL</td><td><input></td><td>mg/dL</td><td><input></td></tr>
        <tr><td>HDL</td><td><input></td><td>mg/dL</td><td><input></td></tr>
        <tr><td>TG</td><td><input></td><td>mg/dL</td><td><input></td></tr>
      </table>
    </div>

    <div class="card">
      <h3>ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØºØ¯Ø© ÙˆØ§Ù„ÙƒÙÙ„Ù‰</h3>
      <table>
        <tr><th>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr>
        <tr><td>TSH</td><td><input></td><td>mIU/L</td><td><input></td></tr>
        <tr><td>T4/FT4</td><td><input></td><td>ng/dL</td><td><input></td></tr>
        <tr><td>Microalbumin/Creatinine</td><td><input></td><td>mg/g</td><td><input></td></tr>
        <tr><td>Creatinine</td><td><input></td><td>mg/dL</td><td><input></td></tr>
      </table>
    </div>

    <div class="card">
      <h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©</h3>
      <input placeholder="ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ¨ / Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©">
    </div>
  </div>

  <script type="module">
    import { auth, db } from './firebase-config.js';
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const params = new URLSearchParams(location.search);
    const childId = params.get('child');
    const childNameEl = document.getElementById('childName');
    const labDate = document.getElementById('labDate');

    const pad = n=>String(n).padStart(2,'0');
    const fmt = d=>`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    labDate.value = fmt(new Date());

    onAuthStateChanged(auth, async (user)=>{
      if(!user){ location.href='index.html'; return; }
      if(!childId){ childNameEl.textContent='â€”'; return; }

      const ref = doc(db, `parents/${user.uid}/children/${childId}`);
      const snap = await getDoc(ref);
      childNameEl.textContent = snap.exists() ? (snap.data().name || 'Ø·ÙÙ„') : 'Ø·ÙÙ„';
    });
  </script>
</body>
</html>
