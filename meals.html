<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ุฅุฏุงุฑุฉ ุงููุฌุจุงุช</title>

  <link rel="icon" href="./favicon.png" />
  <link rel="stylesheet" href="./css/admin.css" />
  <link rel="stylesheet" href="./css/meals.css" />
</head>
<body>
  <header class="topbar">
    <div class="left">
      <a href="index.html" class="btn ghost">ุงูุฑุฆูุณูุฉ</a>
      <a id="backChild" href="#" class="btn ghost">ุงูุทูู</a>
    </div>
    <div class="center"><h1 class="title">ุฅุฏุงุฑุฉ ุงููุฌุจุงุช</h1></div>
    <div class="right"><span id="hdrChildName" class="badge">โ</span></div>
  </header>

  <main class="container">
    <!-- ููุฎุต -->
    <section class="card" id="card-summary">
      <h2 class="card-title">ููุฎุต ุงูุทูู</h2>
      <div class="summary-grid">
        <div class="sum-item"><b>ุงูุงุณู:</b> <span id="s_name">โ</span></div>
        <div class="sum-item"><b>ุงููุญุฏุฉ:</b> <span id="s_unit">โ</span></div>
        <div class="sum-item"><b>CR ุนุงู:</b> <span id="s_cr">โ</span></div>
        <div class="sum-item"><b>CF ุนุงู:</b> <span id="s_cf">โ</span></div>
        <div class="sum-item"><b>ุงููุฏู ุงูุทุจูุนู:</b> <span id="s_normal">โ</span></div>
        <div class="sum-item"><b>ูุฏู ุงูุชุตุญูุญ:</b> <span id="s_targetPref">โ</span></div>
      </div>
      <div id="goalChips" class="chips-row" aria-label="ูุทุงูุงุช ุงููุงุฑุจ"></div>
    </section>

    <!-- ุฅุฏุฎุงู ุงููุฌุจุฉ -->
    <section class="card" id="card-meal">
      <h2 class="card-title">ุฅุถุงูุฉ/ุญุณุงุจ ูุฌุจุฉ</h2>

      <div class="form-grid">
        <label class="field">ููุน ุงููุฌุจุฉ
          <select id="mealType">
            <option value="breakfast">ูุทุงุฑ</option>
            <option value="lunch">ุบุฏุง</option>
            <option value="dinner">ุนุดุง</option>
            <option value="snack">ุณูุงู</option>
          </select>
        </label>

        <label class="field">ูุฑุงุกุฉ ุงูุณูุฑ ุงูุญุงููุฉ
          <input id="glucoseNow" type="number" step="0.1" placeholder="ูุซุงู: 6.2 ุฃู 110" />
          <span class="tiny muted" id="unitHint">โ</span>
        </label>

        <label class="field">ุฌุฑุงู/ูุญุฏุฉ (ุงุฎุชูุงุฑู)
          <input id="gramsPerPortion" type="number" step="0.1" placeholder="ูุซุงู: 15" />
          <span class="tiny muted">ูู ุฃุฏุฎูุชูู + ุงุฎุชุฑุชู ุงููููุฉุ ููุญุณุจ ุงููุงุฑุจ ุชููุงุฆููุง</span>
        </label>

        <label class="field">ุงููููุฉ (ูุญุฏุงุช)
          <input id="portions" type="number" step="0.25" min="0" placeholder="0.25 / 0.5 / 1 ..." />
          <span class="tiny muted">ุงูุฎุทูุฉ 0.25</span>
        </label>

        <label class="field">ูุงุฑุจ ุงููุฌุจุฉ (ุฌุฑุงู)
          <input id="carbs" type="number" step="0.1" placeholder="ุงููุชูุฌุฉ ุฃู ุฅุฏุฎุงู ูุฏูู" />
          <span class="tiny muted">ูู ุฃุฏุฎูุชู ุงููููุฉ + ุงูุฌุฑุงู/ูุญุฏุฉุ ูุชุญุณุจ ุชููุงุฆููุง ููููู ุชุนุฏูููู</span>
        </label>
      </div>

      <div class="mini-grid three">
        <div class="stat">
          <div class="k">CR ุงููุณุชุฎุฏู</div>
          <div class="v" id="crUsed">โ</div>
          <div class="t tiny" id="crSource">โ</div>
        </div>
        <div class="stat">
          <div class="k">CF ุงููุณุชุฎุฏู</div>
          <div class="v" id="cfUsed">โ</div>
          <div class="t tiny" id="cfSource">โ</div>
        </div>
        <div class="stat">
          <div class="k">ูุฏู ุงูุชุตุญูุญ</div>
          <div class="v" id="targetValue">โ</div>
          <div class="t tiny">ูู ุงูุฅุนุฏุงุฏุงุช</div>
        </div>
      </div>

      <div class="calc-grid">
        <div class="calc-card">
          <div class="label">ุฌุฑุนุฉ ุงููุฌุจุฉ (ูู ุงููุงุฑุจ)</div>
          <div class="value" id="doseMeal">โ</div>
          <div class="note tiny">carbs รท CR</div>
        </div>
        <div class="calc-card">
          <div class="label">ุฌุฑุนุฉ ุงูุชุตุญูุญ</div>
          <div class="value" id="doseCorr">โ</div>
          <div class="note tiny">(glucoseNow โ target) รท CF</div>
        </div>
        <div class="calc-card total">
          <div class="label">ุงูุฅุฌูุงูู</div>
          <div class="value" id="doseTotal">โ</div>
          <div class="note tiny">ุชูุฑูุจ ูุฃูุฑุจ 0.05 ูุญุฏุฉ</div>
        </div>
      </div>

      <div class="range-row">
        <span class="badge">ูุทุงู ูุงุฑุจ ุงููุฌุจุฉ: <b id="rangeText">โ</b></span>
        <span class="tiny muted" id="rangeHint">โ</span>
      </div>

      <div class="actions">
        <button id="btnSave" class="btn primary">๐พ ุญูุธ ุงููุฌุจุฉ</button>
        <span id="status" class="tiny muted">โ</span>
      </div>
    </section>

    <!-- ุณูุฉ ุงููุฌุจุฉ -->
    <section class="card" id="card-basket">
      <h2 class="card-title">ุงูุฃุตูุงู ุงููุฎุชุงุฑุฉ ูููุฌุจุฉ</h2>

      <div class="basket-actions">
        <button id="btnOpenLibrary" class="btn">+ ุฅุถุงูุฉ ุตูู ูู ุงูููุชุจุฉ</button>
        <button id="btnSuggestAI" class="btn ghost">๐ค ุงูุชุฑุญ ุจุฏุงุฆู</button>
        <button id="btnAutoFit" class="btn ghost" title="ุงุถุจุท ุงูููุงุฏูุฑ ูุชูุงุณุจ ุงููุฏู">๐ค ุงุถุจุท ุงูููุงุฏูุฑ</button>
        <span id="fitHint" class="tiny muted">โ</span>
        <span class="flex-spacer"></span>
        <button id="btnSavePreset" class="btn">๐พ ุญูุธ ููุฌุจุฉ ุฌุงูุฒุฉ</button>
        <button id="btnLoadPreset" class="btn ghost">๐ ุชุญููู ูุฌุจุฉ ุฌุงูุฒุฉ</button>
      </div>

      <div class="basket-table-wrap">
        <table class="basket-table" id="basketTable" aria-label="ุณูุฉ ุงููุฌุจุฉ">
          <thead>
            <tr>
              <th>ุงูุตูู</th>
              <th>ุงููููุฉ (ูุญุฏุงุช)</th>
              <th>ุฌุฑุงู/ูุญุฏุฉ</th>
              <th>ุงููุงุฑุจ (ุฌู)</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="basketBody"><tr class="empty"><td colspan="5">ูุง ุชูุฌุฏ ุฃุตูุงู ุจุนุฏ</td></tr></tbody>
          <tfoot>
            <tr>
              <td colspan="3" class="total-label">ุฅุฌูุงูู ุงููุงุฑุจ</td>
              <td id="basketTotal" class="total-value">0</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
      <p class="tiny muted">ููุณุชุฎุฏู ุฅุฌูุงูู ุงููุงุฑุจ ุชููุงุฆููุง ูู ุญุณุงุจ ุงูุฌุฑุนุฉ.</p>
    </section>

    <!-- ููุฏุงู ููุชุจุฉ ุงูุฃุตูุงู -->
    <div id="libModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="libTitle">
      <div class="modal-body lib-body">
        <div class="lib-head">
          <h3 id="libTitle">ููุชุจุฉ ุงูุฃุตูุงู</h3>
          <button id="libClose" class="btn">โ</button>
        </div>

        <div class="lib-controls">
          <input id="libSearch" placeholder="ุงุจุญุซ ุจุงุณู ุงูุตููโฆ" />
          <label class="tiny"><input type="checkbox" id="libFilterDiet"> ุงุญุชุฑุงู ุฃูุธูุฉ ุงูุทูู</label>
          <label class="tiny"><input type="checkbox" id="libFilterAllergy" checked> ุงุณุชุจุนุงุฏ ุงูุญุณุงุณููุงุช</label>
        </div>

        <div id="libList" class="lib-list" aria-live="polite"></div>
      </div>
    </div>

    <!-- ููุฏุงู ุจุฏุงุฆู AI -->
    <div id="aiModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="aiTitle">
      <div class="modal-body lib-body">
        <div class="lib-head">
          <h3 id="aiTitle">๐ค ุจุฏุงุฆู ููุชุฑุญุฉ</h3>
          <button id="aiClose" class="btn">โ</button>
        </div>
        <div id="aiList" class="lib-list" aria-live="polite">ุฌุงุฑู ุงูุชุญูููโฆ</div>
      </div>
    </div>

    <!-- ููุฏุงู ุงููุฌุจุงุช ุงูุฌุงูุฒุฉ -->
    <div id="presetModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="presetTitle">
      <div class="modal-body lib-body">
        <div class="lib-head">
          <h3 id="presetTitle">๐ ุงููุฌุจุงุช ุงููุญููุธุฉ</h3>
          <button id="presetClose" class="btn">โ</button>
        </div>
        <div class="lib-controls">
          <input id="presetName" placeholder="ุงุณู ูุญูุธ ุงููุฌุจุฉ ุงูุญุงููุฉโฆ" />
          <button id="presetSaveNow" class="btn">ุญูุธ</button>
        </div>
        <div id="presetList" class="lib-list" aria-live="polite">โ</div>
      </div>
    </div>
  </main>

  <script type="module" src="./js/meals.js"></script>
</body>
</html>
