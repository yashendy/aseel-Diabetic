<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>وجبة الطفل</title>

  <!-- الأسلوب -->
  <link rel="stylesheet" href="css/meals.css" />

  <!-- Firebase config يجب أن يكون قبلي -->
  <script src="js/firebase-config.js"></script>
</head>
<body>

  <header class="page-header">
    <div class="crumbs">
      <a class="btn" href="index.html">الرئيسية 🏠</a>
      <button id="btnBack" class="btn">رجوع</button>
    </div>

    <!-- ملخص أعلى الصفحة: اسم الطفل + معاملات عامة -->
    <div class="child-head">
      <div id="childName" class="child-name">—</div>
      <div class="child-metrics">
        <span>CR: <b id="headCR">—</b></span>
        <span>CF: <b id="headCF">—</b></span>
        <span>ارتفاع: <b id="headHyper">—</b></span>
        <span>ارتفاع شديد: <b id="headCritHigh">—</b></span>
      </div>
    </div>
  </header>

  <main class="container">

    <!-- إجراءات سريعة -->
    <section class="actions">
      <div class="row">
        <label>نوع الوجبة</label>
        <select id="mealType">
          <option value="breakfast">فطار</option>
          <option value="lunch">غداء</option>
          <option value="dinner">عشاء</option>
          <option value="snack">سناك</option>
        </select>

        <label>تاريخ</label>
        <input id="mealDate" type="date" />
      </div>
    </section>

    <!-- القياسات والجرعات -->
    <section class="panel">
      <h3>القياسات والجرعات</h3>

      <div class="grid-3">
        <div class="field">
          <label>قياس قبل الوجبة</label>
          <input id="glucoseBefore" type="number" step="0.1" inputmode="decimal" placeholder="—" />
        </div>

        <div class="field">
          <label>قياس بعد الوجبة</label>
          <input id="glucoseAfter" type="number" step="0.1" inputmode="decimal" placeholder="—" />
        </div>

        <div class="field">
          <label>جرعة التصحيح</label>
          <input id="doseCorrection" type="number" step="0.25" inputmode="decimal" placeholder="0" />
        </div>

        <div class="field">
          <label>جرعة الكارب (مقترحة)</label>
          <input id="doseCarb" type="number" step="0.25" inputmode="decimal" placeholder="0" />
        </div>

        <div class="field">
          <label>إجمالي الجرعة</label>
          <input id="doseTotal" type="number" step="0.25" inputmode="decimal" placeholder="0" />
        </div>

        <div class="field">
          <label>ملاحظات (اختياري)</label>
          <input id="notes" type="text" placeholder="مثال: وجبة خفيفة" />
        </div>
      </div>

      <div class="subnote">
        <span>⚠️ يتم احتساب التصحيح تلقائيًا إذا كان القياس ≥ <b id="critHighMini">—</b> باستخدام (القياس − <b id="hyperMini">—</b>) ÷ CF، والتقريب على 0.25.</span>
      </div>
    </section>

    <!-- هدف الكارب للوجبة -->
    <section class="panel">
      <div class="title-row">
        <h3>هدف الكارب للوجبة</h3>
        <button id="btnSmartFill" class="btn btn-light">توزيع ذكي</button>
      </div>

      <div id="carbGoal" class="carb-goal">
        <div class="bar">
          <div id="carbBar" class="bar__fill" style="width:0%"></div>
        </div>
        <div class="legend">
          <span>الكارب الحالي: <b id="carbNow">0</b> g</span>
          <span>من: <b id="carbMin">—</b> g</span>
          <span>إلى: <b id="carbMax">—</b> g</span>
        </div>
      </div>
    </section>

    <!-- الأصناف المضافة -->
    <section class="panel">
      <div class="title-row">
        <h3>الأصناف المضافة</h3>
        <div class="row-actions">
          <button id="btnAddFromLib" class="btn">إضافة صنف من المكتبة</button>
          <button id="btnSavePreset" class="btn btn-light">حفظ كوجبة جاهزة</button>
          <button id="btnUsePreset" class="btn btn-light">من قالب</button>
        </div>
      </div>

      <div class="table-wrap">
        <table class="table" id="itemsTable">
          <thead>
            <tr>
              <th>الصنف</th>
              <th>التقدير البيتي</th>
              <th>الكمية</th>
              <th>الجرامات (مقفل)</th>
              <th>كارب (g)</th>
              <th>بروتين (g)</th>
              <th>دهون (g)</th>
              <th>سعرات (kcal)</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="itemsBody">
            <!-- تُحقن الصفوف هنا -->
          </tbody>
          <tfoot>
            <tr class="total">
              <td>الإجمالي</td>
              <td></td>
              <td></td>
              <td id="tGrams">0</td>
              <td id="tCarbs">0</td>
              <td id="tProt">0</td>
              <td id="tFat">0</td>
              <td id="tKcal">0</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </section>

    <!-- أزرار الحفظ -->
    <section class="panel center">
      <button id="btnSaveMeal" class="btn primary">💾 حفظ الوجبة</button>
      <button id="btnReset" class="btn">إعادة الضبط</button>
      <button id="btnAI" class="btn btn-light">🤖 شات مساعد</button>
    </section>

  </main>

  <!-- سكربت الصفحة -->
  <script type="module" src="js/meals.js"></script>
</body>
</html>
