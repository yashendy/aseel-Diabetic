<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุงููุฌุจุงุช</title>
  <link rel="stylesheet" href="css/meals.css?v=5" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
</head>
<body>
  <div class="container">
    <!-- Toast -->
    <div id="toast" class="toast hidden" role="status" aria-live="polite">
      <div class="msg"></div>
    </div>

    <!-- ุฑุฃุณ -->
    <div class="row between center mb-12">
      <div class="row center gap-8">
        <button id="backBtn" class="secondary">ุฑุฌูุน</button>
        <h2 class="row center gap-8">ูุฌุจุงุช ุฌุงูุฒุฉ
          <span class="emoji">๐ง</span>
        </h2>
      </div>
      <div class="row center gap-8">
        <button id="saveDraftBtn" class="primary">ุญูุธ ููุณูุฏุฉ</button>
        <div class="dropdown">
          <button id="moreBtn">ุฃุฎุฑู</button>
          <div class="menu" id="moreMenu" hidden>
            <button id="exportBtn">ุชุตุฏูุฑ</button>
            <button id="importBtn">ุงุณุชูุฑุงุฏ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ุจูุงูุงุช ุงูุทูู ูุงููุฌุจุฉ -->
    <div class="card">
      <div class="row wrap gap-12">
        <div>
          <div class="muted tiny">ุงูุทูู</div>
          <div id="childName" class="b"></div>
          <div id="childMeta" class="muted tiny"></div>
        </div>
        <div class="grow"></div>
        <div>
          <div class="muted tiny">ุงูุชุงุฑูุฎ</div>
          <input id="mealDate" type="date" />
        </div>
        <div>
          <div class="muted tiny">ููุน ุงููุฌุจุฉ</div>
          <select id="mealType">
            <option value="breakfast">ูุทูุฑ</option>
            <option value="lunch">ุบุฏุงุก</option>
            <option value="dinner">ุนุดุงุก</option>
            <option value="snack">ุณูุงู</option>
          </select>
        </div>
      </div>

      <div class="row gap-12 mt-12 wrap">
        <div>
          <div class="muted tiny">ุงููุฑุงุกุฉ ูุจู</div>
          <input id="preReading" type="number" step="0.1" />
        </div>
        <div>
          <div class="muted tiny">ุงููุฑุงุกุฉ ุจุนุฏ</div>
          <input id="postReading" type="number" step="0.1" />
        </div>
      </div>
    </div>

    <!-- ูููููุงุช ุงููุฌุจุฉ -->
    <div class="card">
      <div class="row between center">
        <h3>ูููููุงุช ุงููุฌุจุฉ</h3>
        <div class="row gap-8">
          <button id="addItemBtn" class="primary">ุฅุถุงูุฉ ููููู ูู ุงูููุฑุณ</button>
          <button id="repeatLastBtn" class="secondary">ุชูุฑุงุฑ ุขุฎุฑ ูุฌุจุฉ</button>
          <button id="smartAdjustBtn" class="primary">ุถุจุท ุงููุฏู</button>
        </div>
      </div>

      <div class="table mt-12">
        <div class="thead">
          <div>ุญุฐู</div>
          <div>ุฏููู</div>
          <div>ุจุฑูุชูู</div>
          <div>ุณุนุฑุงุช</div>
          <div>ูุงุฑุจ (g)</div>
          <div>ุงูุฌุฑุงูุงุช</div>
          <div>ุงููููุงุณ</div>
          <div>ุงููููุฉ</div>
          <div>ุงููุญุฏุฉ</div>
          <div>ุงูุตูู</div>
        </div>
        <div id="itemsBody" class="tbody"></div>
      </div>

      <div class="sum-grid mt-12">
        <div class="sum cells">
          <div class="muted tiny">ุงูุฏููู</div>
          <div id="tFat" class="b">0</div>
        </div>
        <div class="sum cells">
          <div class="muted tiny">ุงูุจุฑูุชูู</div>
          <div id="tProt" class="b">0</div>
        </div>
        <div class="sum cells">
          <div class="muted tiny">ุงูุณุนุฑุงุช</div>
          <div id="tCal" class="b">0</div>
        </div>
        <div class="sum cells">
          <div class="muted tiny">ุงููุงุฑุจ</div>
          <div id="tCarbs" class="b">0</div>
        </div>
        <div class="sum cells">
          <div class="muted tiny">ุงูุฌุฑุงูุงุช</div>
          <div id="tGrams" class="b">0</div>
        </div>
      </div>

      <div class="mt-12">
        <div class="muted tiny">ููุงุญุธุงุช ุนูู ุงููุฌุจุฉ</div>
        <textarea id="mealNotes" rows="2" placeholder="ุงูุชุจู ููุงุญุธุงุชู ููุง..."></textarea>
      </div>
    </div>

    <!-- ูุนุงูุฑุฉ ุงูุฌุฑุนุฉ -->
    <div class="card">
      <h3>ูุนุงูุฑุฉ ุฐููุฉ ุนู ุงูุฌุฑุนุฉ</h3>
      <div class="muted tiny" id="aiContext">โ</div>
      <div class="row gap-8 mt-8 wrap">
        <div class="cells">
          <div class="muted tiny">ุงูุฌุฑุนุฉ ุงูููุชุฑุญุฉ</div>
          <div id="suggestedDose" class="b">0</div>
        </div>
        <div class="cells">
          <div class="muted tiny">CR/ISF</div>
          <div id="doseExplain" class="b">โ</div>
        </div>
        <div class="cells">
          <div class="muted tiny">ูุทุงู ุงูุฌุฑุนุฉ</div>
          <div id="doseRange" class="b">โ</div>
        </div>
        <div class="cells">
          <div class="muted tiny">ุฌุฑุนุฉ ูุทุจููุฉ</div>
          <div id="appliedDose" class="b">0</div>
        </div>
      </div>
    </div>

    <!-- ูุงูุฐุฉ ุถุจุท ุงููุฏู -->
    <div class="modal hidden" id="adjustModal" aria-modal="true" role="dialog">
      <div class="modal-card">
        <div class="row between center">
          <h3>ุถุจุท ูุฏู ุงููุงุฑุจ</h3>
          <button id="closeAdjust" class="icon-btn">โ</button>
        </div>
        <div class="muted tiny">ุงููุฏู ุงููููุชุฑุญ</div>
        <div class="muted tiny" id="suggestedTarget"></div>

        <div id="adjustDiff" class="mt-12"></div>

        <div class="row gap-8 mt-12">
          <button id="applyAdjustBtn" class="primary">ุชุทุจูู</button>
          <button id="cancelAdjustBtn" class="secondary">ุฅูุบุงุก</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ูุฏุฌุช ูุญุงุฏุซุฉ ุงูุฐูุงุก (ุฎููู) -->
  <div class="ai-widget hidden" id="aiWidget">
    <div class="ai-header">
      <div>
        <strong>ูุญุงุฏุซุฉ ุฐููุฉ ุนู ุงููุฌุจุฉ</strong>
        <div class="muted tiny" id="aiContext">โ</div>
      </div>
      <div>
        <button class="icon-btn" id="aiClose" title="ุฅุบูุงู">โ</button>
      </div>
    </div>
    <div class="ai-body">
      <div id="aiMessages" class="msgs"></div>
    </div>
    <div class="ai-footer">
      <input id="aiInput" type="text" placeholder="ุงูุชุจู ุณุคุงูู ููุง..." />
      <button id="aiSend" class="primary">ุฅุฑุณุงู</button>
    </div>
  </div>

  <!-- ุชุญููู Firebase ูููุญูุงุชูุง -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- ุชููุฆุฉ ููุชุงุญ Gemini ูุชุญููู ุงูููุชุจุฉ ุนูุฏ ูุฌูุฏ ุงูููุชุงุญ -->
  <script>
    /* ุชู ูุถุน ููุชุงุญู ููุง ููุง ุทูุจุชู */
    window.GEMINI_API_KEY = "AIzaSyBJOzP2znhOTBeVDdLn7XwMs_KtYn_tMV4";
  </script>
  <script type="module">
    // ุชุญููู ููุชุจุฉ Gemini ููุท ูู ููู ููุชุงุญ
    if (window.GEMINI_API_KEY) {
      const { GoogleGenerativeAI } = await import("https://esm.run/@google/generative-ai");
      window.GoogleGenerativeAI = GoogleGenerativeAI;
    }
  </script>

  <!-- ุณูุฑุจุช ุงูุตูุญุฉ -->
  <script src="js/meals.js?v=5"></script>
</body>
</html>
