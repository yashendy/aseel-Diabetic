<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุฅุฏุงุฑุฉ ุงููุฌุจุงุช</title>

  <!-- ุณุชุงูู ุงูุตูุญุฉ -->
  <link rel="stylesheet" href="./css/meals.css" />

  <!-- (ุงุฎุชูุงุฑู) Firebase Compat Global - ูููุถูู ูุถุนูุง ูุฑุฉ ูุงุญุฏุฉ ูู layout ุงูุนุงู
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>
  <script src="./js/firebase-config.js"></script>
  -->

  <!-- ุฐูุงุก ุงุตุทูุงุนู Global -->
  <script src="./js/ai.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="topbar__left">
      <a class="btn btn-ghost" href="./child.html" title="ุงูุนูุฏุฉ ูุจูุงูุงุช ุงูุทูู">ุงูุทูู</a>
    </div>
    <h1 class="title">ุฅุฏุงุฑุฉ ุงููุฌุจุงุช <span id="childName" class="badge"></span></h1>
    <div class="topbar__right">
      <button id="btnOpenLib" class="btn btn-primary">ุฅุถุงูุฉ ูู ุงูููุชุจุฉ</button>
    </div>
  </header>

  <main class="layout">
    <!-- ุงูุนููุฏ ุงูุฑุฆูุณู -->
    <section class="main">
      <!-- KPIs -->
      <section class="cards">
        <div class="card kpi">
          <div class="kpi__label">ูุฑุงุกุฉ ุงูุณูุฑ ุงูุญุงููุฉ</div>
          <div class="kpi__value"><input id="glucoseNow" class="input input-lg" type="number" step="0.1" placeholder="โ" /></div>
          <div class="kpi__hint"><span id="unitLabel">mmol/L</span></div>
        </div>
        <div class="card kpi">
          <div class="kpi__label">CF/ISF</div>
          <div class="kpi__value" id="kpiCF">โ</div>
          <div class="kpi__hint">ุญุณุจ ุงููุฌุจุฉ/ุนุงู</div>
        </div>
        <div class="card kpi">
          <div class="kpi__label">CR</div>
          <div class="kpi__value" id="kpiCR">โ</div>
          <div class="kpi__hint">ุญุณุจ ุงููุฌุจุฉ</div>
        </div>
      </section>

      <!-- ููุน ุงููุฌุจุฉ + ูุงุฑุจ ูุฏูู -->
      <section class="card controls">
        <div class="row">
          <div class="col">
            <label class="label">ููุน ุงููุฌุจุฉ</label>
            <select id="mealType" class="select">
              <option value="breakfast">ูุทุงุฑ</option>
              <option value="lunch">ุบุฏุงุก</option>
              <option value="dinner">ุนุดุงุก</option>
              <option value="snack">ุณูุงู</option>
            </select>
          </div>
          <div class="col">
            <label class="label">ูุงุฑุจ ุงููุฌุจุฉ (ุฌู)</label>
            <input id="manualCarbs" class="input" type="number" step="0.1" placeholder="ูู ุฃุฏุฎูุชู ูููุฉ ููุง ุณูุนุชูุฏูุง ุจุฏู ุญุณุงุจ ุงูุฌุฏูู" />
            <div class="muted">ูููููู ุชุฑูู ูุงุฑุบูุง ูุณูุญุณุจ ุชููุงุฆููุง ูู ุงูุฃุตูุงู.</div>
          </div>
        </div>

        <!-- ุดุฑูุท ุงููุทุงู -->
        <div class="range">
          <div class="range__head">
            <span>ูุทุงู ุงููุงุฑุจ</span>
            <span id="rangeText" class="muted">โ</span>
          </div>
          <div class="progress">
            <div id="progressFill" class="progress__fill"></div>
            <div id="progressKnob" class="progress__knob"></div>
          </div>
          <div class="legend">
            <span class="chip chip--ok">ุฏุงุฎู ุงููุทุงู</span>
            <span class="chip chip--warn">ูุฑูุจ ูู ุงูุญุฏูุฏ</span>
            <span class="chip chip--bad">ุฎุงุฑุฌ ุงููุทุงู</span>
          </div>
        </div>

        <div class="actions">
          <button id="btnAI" class="btn btn-ghost">๐ค ุงูุชุฑุงุญ ุจุฏุงุฆู</button>
          <button id="btnAdjust" class="btn btn-ghost">๐ง ุชุนุฏูู ุงูููุงุฏูุฑ (0.25)</button>
          <div class="sep"></div>
          <button id="btnLoadPreset" class="btn">๐ ุชุญููู ูุฌุจุฉ ุฌุงูุฒุฉ</button>
          <button id="btnSavePreset" class="btn">๐ ุญูุธ ููุฌุจุฉ ุฌุงูุฒุฉ</button>
          <button id="btnSaveDraft" class="btn">๐ ุญูุธ ูุณูุฏุฉ</button>
          <button id="btnRestoreDraft" class="btn">โฉ๏ธ ุงุณุชุนุงุฏุฉ ูุณูุฏุฉ</button>
        </div>
      </section>

      <!-- ุฌุฏูู ุงูุฃุตูุงู -->
      <section class="card">
        <h3 class="card__title">ุงูุฃุตูุงู ุงููุฎุชุงุฑุฉ</h3>
        <div class="table">
          <div class="thead">
            <div class="th th--sm">ุญุฐู</div>
            <div class="th">ุงูุตูู</div>
            <div class="th">ุงููููุฉ (ูุญุฏุงุช)</div>
            <div class="th">ุฌุฑุงู/ูุญุฏุฉ</div>
            <div class="th">ุงููุงุฑุจ (ุฌู)</div>
          </div>
          <div id="itemsBody" class="tbody"></div>
          <div class="tfoot">
            <div class="td th--sm"></div>
            <div class="td muted">ุฅุฌูุงูู ุงููุงุฑุจ</div>
            <div class="td"></div>
            <div class="td"></div>
            <div class="td"><span id="totalCarbs">0.0</span></div>
          </div>
        </div>
      </section>

      <!-- ุจุทุงูุงุช ุงูุฌุฑุนุงุช -->
      <section class="cards dose">
        <div class="card dose__card">
          <div class="card__title">ุฌุฑุนุฉ ุงูุฃูู</div>
          <div class="dose__value" id="doseMeal">0.00</div>
          <div class="card__hint">totalCarbs รท CR</div>
        </div>
        <div class="card dose__card">
          <div class="card__title">ุฌุฑุนุฉ ุงูุชุตุญูุญ</div>
          <div class="dose__value" id="doseCorrection">0.00</div>
          <div class="card__hint">max(0, (glucose โ target) รท CF)</div>
        </div>
        <div class="card dose__card dose__card--accent">
          <div class="card__title">ุฅุฌูุงูู ุงูุฌุฑุนุฉ</div>
          <div class="dose__value" id="doseTotal">0.00</div>
          <div class="card__hint">ุชูุฑูุจ 0.05U</div>
        </div>
      </section>

      <div class="row end">
        <button id="btnSaveMeal" class="btn btn-primary">๐พ ุญูุธ ุงููุฌุจุฉ</button>
      </div>
    </section>

    <!-- ุงูุนููุฏ ุงูุฌุงูุจู (Panel) -->
    <aside class="side">
      <section class="card panel">
        <div class="panel__head">
          <h3>ุดุฑุญ ุงูุญุณุงุจ</h3>
          <span id="confidence" class="conf conf--low">Low</span>
        </div>

        <div class="switch">
          <label>
            <input type="checkbox" id="swNetCarbs" />
            ุทุฑุญ ุงูุฃููุงู ูู ุงููุงุฑุจ (ุตุงูู ุงููุงุฑุจ)
          </label>
        </div>

        <div class="panel__list" id="explainList">
          <!-- ุชูุงุตูู: ูุฏุฎูุงุชุ ุตูุบุ ููู ูุณูุทุฉ -->
        </div>

        <div class="panel__tips">
          <h4>ุงุฎุชุตุงุฑุงุช</h4>
          <ul>
            <li><b>Alt+A</b>: ูุชุญ ุงูููุชุจุฉ</li>
            <li><b>Alt+S</b>: ุญูุธ ุงููุฌุจุฉ</li>
            <li><b>Alt+D</b>: ุชุนุฏูู 0.25</li>
            <li><b>Alt+P</b>: ุงูู Presets</li>
          </ul>
        </div>
      </section>
    </aside>
  </main>

  <!-- ููุฏุงู ุงูููุชุจุฉ -->
  <div id="libModal" class="modal">
    <div class="dialog">
      <div class="dialog__head">
        <h3>ุงูููุชุจุฉ</h3>
        <div class="grow"></div>
        <input id="libSearch" class="input" placeholder="ุงุจุญุซู ุจุงุณู ุงูุตูู..." />
        <button class="btn btn-ghost" data-close>ุฅุบูุงู</button>
      </div>
      <div class="dialog__body">
        <div id="libGrid" class="lib-grid"></div>
      </div>
    </div>
  </div>

  <!-- ููุฏุงู ุงูู Presets -->
  <div id="presetModal" class="modal">
    <div class="dialog">
      <div class="dialog__head">
        <h3>ุงููุฌุจุงุช ุงูุฌุงูุฒุฉ</h3>
        <div class="grow"></div>
        <button id="btnNewPreset" class="btn">+ ุญูุธ ููุฌุจุฉ ุฌุงูุฒุฉ</button>
        <button class="btn btn-ghost" data-close>ุฅุบูุงู</button>
      </div>
      <div class="dialog__body">
        <input id="presetSearch" class="input" placeholder="ุจุญุซ ุจุงุณู ุงููุฌุจุฉ..." />
        <div id="presetList" class="preset-list"></div>
      </div>
    </div>
  </div>

  <!-- ุณูุฑุจุช ููุทู ุงูุตูุญุฉ -->
  <script src="./js/meals.js"></script>
</body>
</html>
