<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุฅุฏุงุฑุฉ ุงููุฌุจุงุช</title>

  <!-- ุณุชุงูู ุงูุตูุญุฉ -->
  <link rel="stylesheet" href="./css/meals.css" />

  <!-- Firebase config (ูุฌุจ ุฃู ูุนุฑูู window.db ู window.auth) -->
  <script src="./firebase-config.js"></script>

  <!-- ููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ุจุฏูู export) - ุงุฎุชูุงุฑู ุฅู ููุชู ูุถุนุชูู ุณุงุจููุง -->
  <script src="./js/ai.js"></script>

  <!-- ููุงุชูุญ ุนุงูุฉ (ุงุฎุชูุงุฑู) -->
  <script>
    window.GEMINI_API_KEY = window.GEMINI_API_KEY || ""; /* ุถุนูู ููุง ุฅู ุฑุบุจุชู */
    window.PLACEHOLDER_SVG = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="100" viewBox="0 0 160 100"><rect width="160" height="100" rx="12" fill="%23e5e7eb"/><text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" font-size="14" fill="%239ca3af">no image</text></svg>';
  </script>
</head>
<body>
  <header class="topbar">
    <div class="left">
      <a class="btn" href="./child.html?child={{childId}}">ุงูุทูู</a>
    </div>
    <div class="center">
      <h1>ุฅุฏุงุฑุฉ ุงููุฌุจุงุช <span id="childName" class="tag"></span></h1>
    </div>
    <div class="right">
      <button id="openLib" class="btn btn-primary">ุฅุถุงูุฉ ุตูู ูู ุงูููุชุจุฉ</button>
    </div>
  </header>

  <main class="container">
    <!-- ุจุทุงูุงุช ูุคุดุฑุงุช -->
    <section class="stats">
      <div class="card"><div class="k">CR</div><div class="v" id="statCR">โ</div><div class="s">ุญุณุจ ุงููุฌุจุฉ</div></div>
      <div class="card"><div class="k">CF/ISF</div><div class="v" id="statCF">โ</div><div class="s">ุญุณุจ ุงููุฌุจุฉ/ุนุงู</div></div>
      <div class="card"><div class="k">ูุฑุงุกุฉ ุงูุณูุฑ ุงูุญุงููุฉ</div><div class="v" id="statGlucose">โ</div><div class="s">mmol/L</div></div>
    </section>

    <!-- ููุน ุงููุฌุจุฉ + ูุงุฑุจ ุงููุฌุจุฉ ุงูุฅุฏุฎุงูู -->
    <section class="controls card">
      <div class="row">
        <div class="col">
          <label>ููุน ุงููุฌุจุฉ</label>
          <select id="mealType">
            <option value="breakfast">ูุทุงุฑ</option>
            <option value="lunch">ุบุฏุงุก</option>
            <option value="dinner">ุนุดุงุก</option>
            <option value="snack">ุณูุงู</option>
          </select>
        </div>
        <div class="col">
          <label>ูุงุฑุจ ุงููุฌุจุฉ (ุฌุฑุงู)</label>
          <input id="manualCarbs" type="number" step="0.1" placeholder=".. ูู ุฃุฏุฎูุชู ุงูุญุตุต/ุฌุฑุงู/ูุญุฏุฉ ูุชุญุณุจ ุชููุงุฆููุง" />
        </div>
        <div class="col actions">
          <button id="btnAdjust025" class="btn">ุชุนุฏูู ุงูููุงุฏูุฑ (0.25)</button>
          <button id="btnAI" class="btn">ุงูุชุฑุงุญ ุจุฏุงุฆู ๐ค</button>
        </div>
      </div>

      <!-- ุดุฑูุท ูุทุงู ุงููุงุฑุจ -->
      <div class="range-wrap">
        <div class="range-labels">
          <span id="lblMin">โ</span>
          <span>ูุทุงู ุงููุงุฑุจ</span>
          <span id="lblMax">โ</span>
        </div>
        <div class="range-bar">
          <div id="rangeFill" class="range-fill"></div>
          <div id="rangeMarker" class="range-marker" title="ุฅุฌูุงูู ุงููุงุฑุจ"></div>
        </div>
        <div class="range-legend">
          <span class="g">ุฏุงุฎู ุงููุทุงู</span>
          <span class="y">ูุฑูุจ ูู ุงูุญุฏูุฏ</span>
          <span class="r">ุฎุงุฑุฌ ุงููุทุงู</span>
        </div>
      </div>
    </section>

    <!-- ุฌุฏูู ุงูุฃุตูุงู -->
    <section class="card">
      <div class="table-head">
        <div class="left">
          <button id="savePreset" class="btn">ุญูุธ ููุฌุจุฉ ุฌุงูุฒุฉ ๐</button>
          <button id="loadPreset" class="btn">ุชุญููู ูุฌุจุฉ ุฌุงูุฒุฉ</button>
        </div>
        <div class="right">
          <button id="saveMeal" class="btn btn-primary">ุญูุธ ุงููุฌุจุฉ</button>
        </div>
      </div>

      <div class="table">
        <div class="thead">
          <div>ุญุฐู</div>
          <div>ุงูุตูู</div>
          <div>ุงููููุฉ (ูุญุฏุงุช)</div>
          <div>ุฌุฑุงู/ูุญุฏุฉ</div>
          <div>ุงููุงุฑุจ (ุฌู)</div>
        </div>
        <div id="itemsBody" class="tbody"></div>
      </div>

      <div class="total">
        <div>ุฅุฌูุงูู ุงููุงุฑุจ</div>
        <div id="totalCarbs">0.0</div>
      </div>
    </section>
  </main>

  <!-- ููุชุจุฉ ุงูุฃุตูุงู (ููุฏุงู) -->
  <dialog id="libDialog" class="modal">
    <div class="modal-header">
      <h3>ุงูููุชุจุฉ</h3>
      <button class="icon" id="closeLib">โ</button>
    </div>
    <div id="libGrid" class="lib-grid">
      <!-- ุจุทุงูุงุช ุงูุฃุตูุงู ุชูุญูู ููุง -->
    </div>
    <div class="modal-footer">
      <button id="closeLib2" class="btn">ุฅุบูุงู</button>
    </div>
  </dialog>

  <!-- ุญูุงุฑ ุงุณู ุงููุฌุจุฉ ุงูุฌุงูุฒุฉ -->
  <dialog id="nameDialog" class="modal">
    <div class="modal-header">
      <h3>ุงุณู ุงููุฌุจุฉ</h3>
      <button class="icon" id="closeName">โ</button>
    </div>
    <div class="pad">
      <input id="presetName" placeholder="ูุซุงู: ูุทูุฑ ุณุฑูุน" />
    </div>
    <div class="modal-footer">
      <button id="confirmName" class="btn btn-primary">ุญูุธ</button>
    </div>
  </dialog>

  <!-- ุณูุฑุจุช ุงูุตูุญุฉ -->
  <script src="./js/meals.js"></script>
</body>
</html>
