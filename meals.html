<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ุงููุฌุจุงุช</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="css/meals.css" />
</head>
<body>

  <div id="appLoader" class="loader">
    <span class="spinner"></span>
    <span>ูุฌุฑู ุงูุชุญููู...</span>
  </div>

  <main class="container">
    <div class="topbar">
      <a id="btnBack" class="btn-link" href="#">ุฑุฌูุน ูุตูุญุฉ ุงูุทูู</a>
      <div class="chips">
        <span id="chipTargets" class="chip">ุงููุฏู: โ</span>
        <span id="chipCR" class="chip">CR: โ</span>
        <span id="chipCF" class="chip">CF: โ</span>
      </div>
    </div>

    <section class="grid-2">
      <!-- ูุฌุจุฉ ุงูููู -->
      <div class="panel">
        <h3>ูุฌุจุฉ ุงูููู</h3>

        <table class="meal-table" id="mealTable">
          <thead>
            <tr>
              <th>ุญุฐู</th>
              <th>GL</th>
              <th>GI</th>
              <th>ุฃููุงู</th>
              <th>Net Carbs</th>
              <th>(raw) ูุงุฑุจ</th>
              <th>Calories</th>
              <th>ุฌุฑุงู ููุงูุฆ</th>
              <th>ุงููููุฉ</th>
              <th>ุงููุญุฏุฉ</th>
              <th>ุงูุตูู</th>
              <th>ุงูุตูุฑุฉ</th>
            </tr>
          </thead>
          <tbody id="mealBody">
            <tr class="empty"><td colspan="12" style="text-align:center;color:#888">โ</td></tr>
          </tbody>
          <tfoot>
            <tr>
              <td></td>
              <td id="sumGL">0</td>
              <td id="sumGI">โ</td>
              <td id="sumFiber">0 g</td>
              <td id="sumCarbsNet">0 g</td>
              <td id="sumCarbsRaw">0 g</td>
              <td id="sumCalories">0 kcal</td>
              <td colspan="5">
                <span>U โ ุงูุฌุฑุนุฉ ุงูููุงุฆูุฉ:</span>
                <strong id="doseFinal">0</strong>
              </td>
            </tr>
          </tfoot>
        </table>

        <div class="row wrap">
          <button id="btnSaveMeal" class="btn primary">ุญูุธ ุงููุฌุจุฉ</button>
          <button id="btnSaveTemplate" class="btn">ุญูุธ ููุงูุจ</button>
          <button id="btnLoadTemplates" class="btn">ุงุณุชูุฑุงุฏ ูู ุงูููุงูุจ</button>
          <button id="btnExportCSV" class="btn">ุชุตุฏูุฑ (CSV)</button>
          <button id="btnPrint" class="btn">ุชุตุฏูุฑ PDF</button>
          <button id="btnSaveFavorites" class="btn gray">ุญูุธ/ุงุณุชุจุนุงุฏ ุบูุฑ ุงูููุถูุฉ</button>
          <button id="btnChat" class="btn alt">๐ฌ ูุญุงุฏุซุฉ</button>
        </div>
      </div>

      <!-- ููุญุฉ ุงูููู -->
      <div class="panel">
        <h3>ููุญุฉ ุงูููู</h3>

        <div class="row">
          <label>ุงููุฌุจุฉ</label>
          <select id="slotSelect">
            <option value="b">ูุทุงุฑ</option>
            <option value="l">ุบุฏุง</option>
            <option value="d">ุนุดุง</option>
            <option value="s">ุณูุงู</option>
          </select>
        </div>

        <div class="row">
          <label>ุชุงุฑูุฎ ุงููุฌุจุฉ</label>
          <input id="dateInput" type="date" />
        </div>

        <div class="row">
          <label>(mmol/L) ูุฑุงุกุฉ ูุจู ุงููุฌุจุฉ</label>
          <input id="preBg" type="number" step="0.1" inputmode="decimal" />
          <button id="btnFetchPre" class="btn sm">ุฌูุจ ุชููุงุฆู</button>
        </div>

        <div class="row">
          <label>ูุงุนุฏุฉ ุตุงูู ุงููุงุฑุจ</label>
          <select id="netCarbRule">
            <option value="none">ุจุฏูู ุฎุตู ุงูุฃููุงู</option>
            <option value="halfFiber">ุฎุตู ูุตู ุงูุฃููุงู</option>
            <option value="fullFiber">ุฎุตู ูุงูู ุงูุฃููุงู</option>
          </select>
        </div>

        <div class="row"><label>ุฌุฑุนุฉ ุงูุชุตุญูุญ (U)</label><input id="doseCorrection" type="number" step="0.1" /></div>
        <div class="row"><label>ุฌุฑุนุฉ ุงููุงุฑุจ (U)</label><input id="doseCarbs" type="number" step="0.1" /></div>

        <div class="row">
          <label>ุฅุฌูุงูู ูุงุฑุจ ุงูููู: g</label>
          <input id="dayCarbs" type="number" step="1" />
        </div>

        <div class="row">
          <div class="progress"><div id="progressBar" class="bar" style="width:0%"></div></div>
        </div>

        <div class="row right">
          <button id="btnScaleToTarget" class="btn">ุงุถุจุท ูููุตูู ูููุฏู</button>
          <button id="btnClearMeal" class="btn gray">ูุณุญ</button>
          <button id="btnOpenLibrary" class="btn alt">ุงูุชุญ ููุชุจุฉ ุงูุฃุตูุงู</button>
        </div>
      </div>
    </section>
  </main>

  <!-- ููุชุจุฉ ุงูุฃุตูุงู (ููุฏุงู ุจุณูุฑูู ุฏุงุฎูู) -->
  <div id="libModal" class="lib-modal">
    <div id="libOverlay" class="lib-overlay" data-close></div>
    <div class="lib-panel">
      <div class="lib-header">
        <h4>ููุชุจุฉ ุงูุฃุตูุงู</h4>
        <button id="libClose" class="lib-close" data-close>ร</button>
      </div>
      <div class="lib-content">
        <div class="lib-actions">
          <input id="searchBox" class="input" type="search" placeholder="ุงุจุญุซ ุนู ุตูู..." />
        </div>
        <div id="itemsGrid" class="grid"></div>
      </div>
    </div>
  </div>

  <!-- ููุงูุจ -->
  <div id="tplModal" class="lib-modal">
    <div class="lib-overlay" data-close></div>
    <div class="lib-panel">
      <div class="lib-header">
        <h4>ุงูููุงูุจ</h4>
        <button class="lib-close" data-close>ร</button>
      </div>
      <div class="lib-content">
        <div id="tplList" class="tpl-list"></div>
      </div>
    </div>
  </div>

  <!-- ุงูุดุงุช (ููุญุฉ ุฌุงูุจูุฉ) -->
  <aside id="chatDrawer" class="chat">
    <div class="chat-head">
      <strong>ูุญุงุฏุซุฉ ุงููุฌุจุฉ</strong>
      <button id="btnChatClose" class="lib-close">ร</button>
    </div>
    <div id="chatLog" class="chat-log"></div>
    <div class="chat-input">
      <input id="chatMsg" type="text" placeholder="ุงุณุฃู ุนู ุงูุฌุฑุนุงุช ุฃู ุงููุงุฑุจ..." />
      <button id="btnChatSend" class="btn primary">ุฅุฑุณุงู</button>
    </div>
  </aside>

  <script type="module" src="js/meals.js"></script>
</body>
</html>
