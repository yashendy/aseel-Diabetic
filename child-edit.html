<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>إعدادات الطفل</title>
  <link rel="stylesheet" href="./css/child-edit.css" />
</head>
<body>
  <div class="container" id="childEditPage">
    <div class="top">
      <h1>إعدادات الطفل</h1>
      <span id="childIdBadge" class="badge">—</span>
      <div class="grow"></div>
      <button id="btnRefresh" class="btn ghost" type="button">تحديث ↻</button>
    </div>

    <!-- بطاقة تعريف -->
    <section class="card">
      <div class="section-head">
        <h2>بطاقة الطفل</h2>
        <span class="muted small">عرض عام</span>
      </div>
      <div class="row-1">
        <div>
          <label>الاسم</label>
          <input id="f_name" placeholder="الاسم (اختياري)" />
        </div>
        <div>
          <label>الجنس</label>
          <select id="f_gender">
            <option value="">—</option>
            <option value="ذكر">ذكر</option>
            <option value="أنثى">أنثى</option>
          </select>
        </div>
        <div>
          <label>تاريخ الميلاد</label>
          <input id="f_birthDate" type="date" />
        </div>
        <div>
          <label>الوحدة الافتراضية</label>
          <select id="f_unit">
            <option value="mmol">mmol/L</option>
            <option value="mgdl">mg/dL</option>
          </select>
        </div>
        <div>
          <label>اسم الجهاز</label>
          <input id="f_deviceName" placeholder="مثلاً: Glucodr" />
        </div>
      </div>
    </section>

    <!-- المقاييس الأساسية -->
    <section class="card">
      <div class="section-head">
        <h2>المقاييس الأساسية</h2>
      </div>
      <div class="row-1">
        <div>
          <label>الوزن (كجم)</label>
          <input id="f_weightKg" type="number" step="0.1" />
        </div>
        <div>
          <label>الطول (سم)</label>
          <input id="f_heightCm" type="number" step="0.1" />
        </div>
      </div>
    </section>

    <!-- الأنسولين -->
    <section class="card">
      <div class="section-head">
        <h2>الأنسولين</h2>
      </div>
      <div class="row-1">
        <div>
          <label>نوع القاعدي (Basal)</label>
          <input id="f_basalType" placeholder="مثلاً: لانتوس / تريسيبا" />
        </div>
        <div>
          <label>نوع الوجبات/السريع (Bolus)</label>
          <input id="f_bolusType" placeholder="مثلاً: نوفورابيد" />
        </div>
      </div>
      <fieldset>
        <legend>جرعة طويل المفعول</legend>
        <div class="row-1">
          <div>
            <label>الأنسولين</label>
            <input id="f_longInsulin" placeholder="اسم الأنسولين" />
          </div>
          <div>
            <label>الوقت (HH:MM)</label>
            <input id="f_longTime" type="time" />
          </div>
          <div>
            <label>الوحدات</label>
            <input id="f_longUnits" type="number" step="0.1" />
          </div>
        </div>
      </fieldset>
    </section>

    <!-- الكارب والإعدادات -->
    <section class="card">
      <div class="section-head">
        <h2>الكارب والإعدادات</h2>
      </div>
      <div class="row-1">
        <div>
          <label>Carb Ratio (جرام كارب لكل 1U)</label>
          <input id="f_carbRatio" type="number" step="0.1" />
        </div>
        <div>
          <label>معامل التصحيح (Correction Factor)</label>
          <input id="f_correctionFactor" type="number" step="0.1" />
        </div>
        <div>
          <label>تفعيل صافي الكارب</label>
          <div class="row-switch">
            <span class="muted small">Use Net Carbs</span>
            <label class="switch">
              <input id="f_useNetCarbs" type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div>
          <label>قاعدة صافي الكارب</label>
          <select id="f_netCarbRule">
            <option value="">—</option>
            <option value="fullFiber">استبعاد الألياف بالكامل</option>
            <option value="halfFiber">استبعاد نصف الألياف</option>
            <option value="none">بدون استبعاد</option>
          </select>
        </div>
      </div>
    </section>

    <!-- نطاقات الكارب للوجبات -->
    <section class="card">
      <div class="section-head"><h2>نطاقات الكارب للوجبات (جرام)</h2></div>
      <div class="targets-grid">
        <div class="meal-col">
          <h4>فطور</h4>
          <div class="unit-row">
            <div>
              <label>Min</label>
              <input id="f_carb_b_min" type="number" step="0.1" />
            </div>
            <div>
              <label>Max</label>
              <input id="f_carb_b_max" type="number" step="0.1" />
            </div>
          </div>
        </div>
        <div class="meal-col">
          <h4>غداء</h4>
          <div class="unit-row">
            <div>
              <label>Min</label>
              <input id="f_carb_l_min" type="number" step="0.1" />
            </div>
            <div>
              <label>Max</label>
              <input id="f_carb_l_max" type="number" step="0.1" />
            </div>
          </div>
        </div>
        <div class="meal-col">
          <h4>عشاء</h4>
          <div class="unit-row">
            <div>
              <label>Min</label>
              <input id="f_carb_d_min" type="number" step="0.1" />
            </div>
            <div>
              <label>Max</label>
              <input id="f_carb_d_max" type="number" step="0.1" />
            </div>
          </div>
        </div>
        <div class="meal-col">
          <h4>سناك</h4>
          <div class="unit-row">
            <div>
              <label>Min</label>
              <input id="f_carb_s_min" type="number" step="0.1" />
            </div>
            <div>
              <label>Max</label>
              <input id="f_carb_s_max" type="number" step="0.1" />
            </div>
          </div>
        </div>
      </div>
      <p class="hint">هذا النطاق هو كمية الكارب المقترحة لكل وجبة (جرام) — وليس توقيت الوجبة.</p>
    </section>

    <!-- مستويات السكر والحدود -->
    <section class="card">
      <div class="section-head"><h2>مستويات السكر والحدود</h2></div>
      <fieldset>
        <legend>النطاق الطبيعي</legend>
        <div class="unit-row">
          <div>
            <label>Min</label>
            <input id="f_norm_min" type="number" step="0.1" />
          </div>
          <div>
            <label>Max</label>
            <input id="f_norm_max" type="number" step="0.1" />
          </div>
        </div>
      </fieldset>
      <div class="row-1">
        <div>
          <label>Low (hypo)</label>
          <input id="f_hypo" type="number" step="0.1" />
        </div>
        <div>
          <label>High (hyper)</label>
          <input id="f_hyper" type="number" step="0.1" />
        </div>
        <div>
          <label>Severe Low</label>
          <input id="f_severeLow" type="number" step="0.1" />
        </div>
        <div>
          <label>Severe High</label>
          <input id="f_severeHigh" type="number" step="0.1" />
        </div>
      </div>
    </section>

    <!-- ربط الطفل بدكتور -->
    <section class="card">
      <div class="section-head">
        <h2>الطبيب والخصوصية</h2>
        <span id="doctorState" class="badge">غير مرتبط</span>
      </div>
      <div class="grid-2">
        <div class="field">
          <label>كود الربط</label>
          <input id="codeInput" placeholder="أدخل كود الربط" />
        </div>
        <div class="inline-end">
          <button id="btnLink" class="btn good" type="button">ربط مع دكتور</button>
          <button id="btnUnlink" class="btn danger" type="button">إلغاء الربط</button>
        </div>
      </div>

      <div class="row-switch">
        <span class="muted small">موافقة مشاركة البيانات مع الطبيب</span>
        <label class="switch">
          <input id="f_shareDoctor" type="checkbox" />
          <span class="slider"></span>
        </label>
      </div>
      <div id="linkStatus" class="status"></div>
    </section>

    <div class="form-actions">
      <button id="btnBack" class="btn back" type="button">رجوع</button>
      <button id="btnSave" class="btn" type="button">حفظ التغييرات ✅</button>
    </div>
  </div>

  <div id="loader" class="loader hidden" aria-live="polite"></div>
  <div id="toast" class="toast hidden"><div class="msg">تم</div></div>

  <script type="module" src="./js/child-edit.js"></script>
</body>
</html>
