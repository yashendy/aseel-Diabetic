<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุชุญููู ุงูููุงุณุงุช</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="css/analytics.css?v=7" />
</head>
<body>
  <div class="container">

    <header class="card top">
      <div class="head-row">
        <div class="title-wrap">
          <h1>๐ ุชุญููู ุงูููุงุณุงุช โ <span id="childName">ุทูู</span></h1>
          <div id="childMeta" class="muted tiny">โ</div>
        </div>
        <div class="actions">
          <button id="backBtn" class="btn secondary">โฉ๏ธ ุฑุฌูุน</button>
        </div>
      </div>

      <div class="controls">
        <div class="row">
          <div class="field">
            <label>ุงููุชุฑุฉ</label>
            <div class="chip-row">
              <button class="chip" data-range="14">ุขุฎุฑ 14 ููู</button>
              <button class="chip" data-range="30">ุขุฎุฑ 30 ููู</button>
              <button class="chip" data-range="90">ุขุฎุฑ 90 ููู</button>
            </div>
          </div>
          <div class="field">
            <label>ูู</label>
            <input type="date" id="fromDate" />
          </div>
          <div class="field">
            <label>ุฅูู</label>
            <input type="date" id="toDate" />
          </div>
          <div class="field">
            <label>ุงููุญุฏุฉ</label>
            <select id="unitSel">
              <option value="mmol">mmol/L</option>
              <option value="mgdl">mg/dL</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="chip-row">
            <button id="fltAll"   class="chip active">ุงููู</button>
            <button id="fltPre"   class="chip">ูุจู ุงููุฌุจุงุช</button>
            <button id="fltPost"  class="chip">ุจุนุฏ ุงููุฌุจุงุช</button>
            <button id="fltSleep" class="chip">ุงูููู</button>
            <button id="fltSport" class="chip">ุงูุฑูุงุถุฉ</button>
          </div>
          <div class="btn-row">
            <button id="applyBtn" class="btn primary">ุชุทุจูู</button>
            <button id="pdfBtn" class="btn">๐จ๏ธ PDF / ุทุจุงุนุฉ</button>
            <button id="csvBtn" class="btn secondary">๐ฅ CSV ุชูุฒูู</button>
            <button id="aiOpen" class="btn">๐ค ูุณุงุนุฏ ุงูุชุญููู</button>
          </div>
        </div>
      </div>
    </header>

    <!-- ูุฑูุช ุงูููุฎุต -->
    <section class="cards">
      <div class="card stat"><div class="lab">ุนุฏุฏ ุงูููุงุณุงุช</div><div class="val" id="cntCard">โ</div></div>
      <div class="card stat"><div class="lab">ุงูุงูุญุฑุงู ุงููุนูุงุฑู</div><div class="val" id="trendCard">โ</div></div>
      <div class="card stat"><div class="lab">ุงููุชูุณุท</div><div class="val" id="avgCard">โ</div></div>
      <div class="card stat"><div class="lab">ูุจูุทุงุช</div><div class="val" id="hypoCard">โ</div></div>
      <div class="card stat"><div class="lab">(TIR) ููุช ุฏุงุฎู ุงููุทุงู</div><div class="val" id="tirCard">โ</div></div>
    </section>

    <!-- ุงูุฑุณู 1: ุฎุทูู ุฒููู -->
    <section class="card">
      <div class="table-head">
        <h3>ููุญูู ุงูุฌููููุฒ ูุน ุงูุฒูู</h3>
      </div>
      <canvas id="timeChart" height="120"></canvas>
    </section>

    <!-- ุงูุฑุณู 2: ุฏููุงุช ุงูุชูุฒูุน -->
    <section class="card">
      <div class="table-head">
        <h3>ุชูุฒูุน ุงูููุงุณุงุช ุญุณุจ ุงูููุช</h3>
      </div>
      <canvas id="donutChart" height="120"></canvas>
    </section>

    <!-- ุฌุฏูู ุงูุชูุฒูุน -->
    <section class="card">
      <div class="table-head">
        <h3>ุชูุตูู ุญุณุจ ููุช ุงูููุงุณ</h3>
      </div>
      <div class="table-wrap">
        <table class="table">
          <thead>
          <tr><th>ุงูููุช</th><th>ุงูุนุฏุฏ</th><th>ูุชูุณุท mmol/L</th></tr>
          </thead>
          <tbody id="slotTableBody"></tbody>
        </table>
      </div>
    </section>

  </div>

  <!-- ููุฏุฌุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู -->
  <div id="aiWidget" class="ai hidden">
    <div class="ai-head">
      <div class="ai-title">๐ค ูุณุงุนุฏ ุงูุชุญููู</div>
      <div class="ai-actions">
        <button id="aiMin" class="ai-btn">โ</button>
        <button id="aiClose" class="ai-btn">โ</button>
      </div>
    </div>
    <div class="ai-body">
      <div id="aiContext" class="ai-context muted tiny">โ</div>
      <div id="aiMessages" class="ai-messages"></div>
      <div class="ai-input">
        <textarea id="aiInput" rows="2" placeholder="ุงุณุฃู ุนู ุงูุชุญููู ุฃู ุงุทูุจ ุชูุณูุฑูุง..."></textarea>
        <button id="aiSend" class="btn primary">ุฅุฑุณุงู</button>
      </div>
    </div>
  </div>

  <!-- Chart.js UMD (ูุณุชูุฑ) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

  <!-- Firebase + ููุทู ุงูุตูุญุฉ -->
  <script type="module" src="js/analytics.js?v=7"></script>
</body>
</html>
