<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ุชุญููู ุงูููุงุณุงุช</title>

  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="stylesheet" href="css/analytics.css?v=7">

  <!-- Chart.js v4 + time scale + date-fns adapter + ar locale -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/date-fns@3/locale/ar-EG/index.min.js"></script>
</head>
<body>
  <div class="container">

    <header class="top card">
      <div class="head-row">
        <div class="left">
          <h1>๐ ุชุญููู ุงูููุงุณุงุช โ <span id="childName">ุทูู</span>
            <button id="backBtn" class="btn ghost">โฉ๏ธ ุฑุฌูุน</button>
          </h1>
          <p class="muted tiny">
            <span id="childMeta">โ</span>
          </p>
        </div>

        <div class="right controls">
          <div class="row">
            <label>ุงููุชุฑุฉ</label>
            <div class="chips">
              <button data-range="14d" class="chip range-btn">ุขุฎุฑ 14 ููู</button>
              <button data-range="30d" class="chip range-btn">ุขุฎุฑ 30 ููู</button>
              <button data-range="90d" class="chip range-btn">ุขุฎุฑ 90 ููู</button>
              <button data-range="all" class="chip range-btn">ุงููู</button>
            </div>
          </div>

          <div class="row">
            <label>ูู</label>
            <input type="date" id="dateFrom">
            <label>ุฅูู</label>
            <input type="date" id="dateTo">
            <label>ุงููุญุฏุฉ</label>
            <select id="unitSelect">
              <option value="mmol">mmol/L</option>
              <option value="mgdl">mg/dL</option>
            </select>
            <button id="applyBtn" class="btn">ุชุทุจูู</button>
          </div>

          <div class="row">
            <div class="chips">
              <button class="chip slot" data-slot="PRE_BREAKFAST">ูุจู ุงููุทูุฑ</button>
              <button class="chip slot" data-slot="POST_BREAKFAST">ุจุนุฏ ุงููุทูุฑ</button>
              <button class="chip slot" data-slot="PRE_LUNCH">ูุจู ุงูุบุฏุงุก</button>
              <button class="chip slot" data-slot="POST_LUNCH">ุจุนุฏ ุงูุบุฏุงุก</button>
              <button class="chip slot" data-slot="PRE_DINNER">ูุจู ุงูุนุดุงุก</button>
              <button class="chip slot" data-slot="POST_DINNER">ุจุนุฏ ุงูุนุดุงุก</button>
              <button class="chip slot" data-slot="SNACK">ุณูุงู</button>
              <button class="chip slot active" data-slot="ALL">ุงููู</button>
            </div>
          </div>

          <div class="row actions">
            <button id="btnAI" class="btn secondary">๐ค ูุณุงุนุฏ ุงูุชุญููู</button>
            <button id="btnCSV" class="btn secondary">๐งพ ุชูุฒูู CSV</button>
            <button id="btnPDF" class="btn secondary">๐จ๏ธ PDF / ุทุจุงุนุฉ</button>
          </div>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat"><div class="label">ุนุฏุฏ ุงูููุงุณุงุช</div><div class="value" id="stCount">โ</div></div>
        <div class="stat"><div class="label">ุงููุชูุณุท</div><div class="value" id="stAvg">โ</div></div>
        <div class="stat"><div class="label">ุงูุงูุญุฑุงู ุงููุนูุงุฑู</div><div class="value" id="stStd">โ</div></div>
        <div class="stat"><div class="label">(TIR) ููุช ุฏุงุฎู ุงููุทุงู</div><div class="value" id="stTir">โ</div></div>
        <div class="stat"><div class="label">ุงุฑุชูุงุนุงุช</div><div class="value red" id="stHigh">โ</div></div>
        <div class="stat"><div class="label">ูุจูุทุงุช</div><div class="value blue" id="stLow">โ</div></div>
      </div>
    </header>

    <section class="card">
      <h3>ููุญูู ุงูุฌููููุฒ ูุน ุงูุฒูู</h3>
      <canvas id="lineChart" height="110"></canvas>
    </section>

    <section class="card">
      <h3>ุชูุฒูุน ุงูููุงุณุงุช ุญุณุจ ุงูููุช</h3>
      <canvas id="pieChart" height="110"></canvas>
    </section>

  </div>

  <!-- ูุงูุฐุฉ ูุณุงุนุฏ Gemini (ุงุฎุชูุงุฑู) -->
  <div id="aiWidget" class="ai hidden" aria-live="polite">
    <div class="ai-head">
      <b>๐ค ูุณุงุนุฏ ุงูุชุญููู</b>
      <div>
        <button id="aiMin" class="icon">โ</button>
        <button id="aiClose" class="icon">โ</button>
      </div>
    </div>
    <div class="ai-body">
      <div class="ai-context tiny muted" id="aiContext">ุจุฏูู ุณูุงู ุฅุถุงูู</div>
      <div id="aiMessages" class="ai-messages"></div>
    </div>
    <div class="ai-input">
      <textarea id="aiInput" rows="2" placeholder="ุงุณุฃู ุนู ุงููุชุงุฆุฌ.."></textarea>
      <button id="aiSend" class="btn">ุฅุฑุณุงู</button>
    </div>
  </div>

  <!-- ุณูุฑุจุช ุงูุตูุญุฉ (ูุธุงู Firebase ุงูุญุงูู ูุฏูู) -->
  <script type="module" src="js/analytics.js?v=7"></script>
</body>
</html>
