<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>لوحة الإدارة</title>
    <link rel="stylesheet" href="./css/admin.css" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="logo">SK</span>
      <strong>لوحة الإدارة</strong>
    </div>

    <div class="spacer"></div>

    <!-- زر الأصناف الغذائية -->
    <a class="btn ghost" href="food-items.html" id="btnFoodItems">الأصناف الغذائية</a>
    <a class="btn ghost" href="admin-import.html" id="btnUsdaImport">استيراد USDA</a>


    <div class="admin-info">
      <span id="adminName">—</span>
      <button id="btnSignOut" class="btn ghost">خروج</button>
    </div>
  </header>

  <main class="container">
    <!-- بطاقات إحصائية -->
    <section class="cards">
      <div class="card">
        <div class="card-title">الأطباء</div>
        <div class="card-value" id="doctorsCount">0</div>
      </div>
      <div class="card">
        <div class="card-title">الأطفال</div>
        <div class="card-value" id="childrenCount">0</div>
      </div>
      <div class="card">
        <div class="card-title">عمليات اليوم</div>
        <div class="card-value" id="opsToday">—</div>
      </div>
    </section>

    <!-- سكشن إسناد طبيب لطفل -->
    <section class="panel">
      <div class="panel-head">
        <h2>إسناد طبيب لطفل</h2>
        <div class="actions" style="display:flex; gap:8px">
          <button id="btnRefreshChildren" class="btn ghost">تحديث الأطفال ↻</button>
          <button id="btnRefreshLists" class="btn ghost">تحديث القوائم ↻↻</button>
        </div>
      </div>

      <div class="grid-3">
        <div class="field">
          <label for="childSearch">بحث عن طفل</label>
          <input id="childSearch" type="text" class="input" placeholder="اكتب اسم الطفل أو ولي الأمر…" />
        </div>
        <div class="field">
          <label for="doctorSearch">بحث عن دكتور</label>
          <input id="doctorSearch" type="text" class="input" placeholder="اكتب اسم/إيميل الدكتور…" />
        </div>
        <div class="field align-end">
          <button id="btnOpenAssign" class="btn primary">فتح نافذة الإسناد</button>
        </div>
      </div>

      <div class="lists-wrap">
        <!-- جدول الأطفال -->
        <div class="list-card">
          <div class="list-title">الأطفال</div>
          <div class="list-sub">اختر طفلًا للإسناد</div>
          <div class="list-actions">
            <span class="muted small" id="childrenHint">—</span>
          </div>
          <div class="list-body">
            <table class="tbl">
              <thead>
                <tr>
                  <th>الطفل</th>
                  <th>وليّ الأمر</th>
                  <th>الموافقة</th>
                  <th>اختيار</th>
                </tr>
              </thead>
              <tbody id="childrenTbody">
                <tr><td class="empty" colspan="4">جارٍ التحميل…</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- جدول الأطباء -->
        <div class="list-card">
          <div class="list-title">الأطباء</div>
          <div class="list-sub">اختر طبيبًا</div>
          <div class="list-actions">
            <span class="muted small" id="doctorsHint">—</span>
          </div>
          <div class="list-body">
            <table class="tbl">
              <thead>
                <tr>
                  <th>الاسم</th>
                  <th>الإيميل</th>
                  <th>اختيار</th>
                </tr>
              </thead>
              <tbody id="doctorsTbody">
                <tr><td class="empty" colspan="3">جارٍ التحميل…</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="assignStatus" class="status"></div>
    </section>
  </main>

  <!-- مودال الإسناد -->
  <div id="assignModal" class="modal hidden" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-head">
        <h3>تأكيد إسناد الطبيب</h3>
        <button class="icon-btn" id="btnCloseModal" aria-label="إغلاق">✕</button>
      </div>
      <div class="modal-body">
        <div class="grid-2">
          <div>
            <label>الطفل</label>
            <select id="childSelect" class="input"></select>
          </div>
          <div>
            <label>الطبيب</label>
            <select id="doctorSelect" class="input"></select>
          </div>
        </div>
        <div class="muted" id="modalHint">سيتم تعيين الطبيب المختار ويُسمح له بالاطلاع.</div>
        <div id="modalStatus" class="status"></div>
      </div>
      <div class="modal-foot">
        <button id="btnAssign" class="btn primary">إسناد الآن ✅</button>
        <button id="btnCancelAssign" class="btn ghost">إلغاء</button>
      </div>
    </div>
  </div>

  <div id="loader" class="loader hidden" aria-live="polite">جارٍ المعالجة…</div>
  <div id="toast" class="toast hidden"><div class="msg">تم</div></div>

  <script type="module" src="./js/admin.js"></script>
</body>
</html>
