:root{
  --bg:#f7f8fb; --panel:#fff; --muted:#8a8f98; --text:#222; --primary:#5b6cff; --accent:#7c3aed;
  --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444; --br:16px;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",Tahoma,Arial,sans-serif}
.container{max-width:1100px;margin:24px auto;padding:0 12px}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.btn-link{color:var(--accent);text-decoration:none}
.chips{display:flex;gap:8px}
.chip{background:#eef;border-radius:999px;padding:6px 10px;font-size:12px;color:#444}

.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.panel{background:var(--panel);border-radius:var(--br);padding:16px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
.panel h3{margin:0 0 12px}

.row{display:flex;gap:8px;align-items:center;margin:8px 0}
.row.right{justify-content:flex-end}
.row.wrap{flex-wrap:wrap}
.input, input[type="text"], input[type="number"], input[type="date"], select{
  padding:8px 10px;border:1px solid #e6e8ee;border-radius:10px;background:#fff;min-width:0
}

.btn{border:0;border-radius:999px;padding:8px 14px;background:#e8ebf7;color:#333;cursor:pointer}
.btn:hover{opacity:.95}
.btn.gray{background:#ececec}
.btn.alt{background:#dbeafe}
.btn.primary{background:var(--primary);color:#fff}
.btn.sm{padding:6px 10px;font-size:12px}

.progress{width:100%;height:10px;background:#eef;border-radius:999px;overflow:hidden}
.bar{height:100%;background:var(--ok);transition:width .25s ease;width:0%}

.meal-table{width:100%;border-collapse:collapse}
.meal-table th,.meal-table td{border-bottom:1px solid #eee;padding:8px;font-size:13px;vertical-align:middle}
.meal-table thead th{background:#f5f7ff}
.meal-table tfoot td{background:#fafafa;font-weight:600}
.meal-table input[type="number"]{width:96px}

/* Loader */
.loader{position:fixed;inset:0;background:#fff;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;z-index:50}
.spinner{width:22px;height:22px;border-radius:50%;border:2px solid #e5e7eb;border-top-color:var(--primary);animation:sp 1s linear infinite}
@keyframes sp{to{transform:rotate(1turn)}}

/* Library Modal (scrollable) */
.lib-modal{position:fixed;inset:0;display:none;z-index:60}
.lib-modal.open{display:block}
.lib-overlay{position:absolute;inset:0;background:rgba(0,0,0,.35)}
.lib-panel{position:relative;z-index:1;background:#fff;margin:4vh auto;border-radius:14px;max-width:980px;box-shadow:0 20px 50px rgba(0,0,0,.25);
  display:flex;flex-direction:column;max-height:90vh}
.lib-header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #eee}
.lib-close{border:0;background:#f2f2f2;border-radius:10px;width:36px;height:36px;cursor:pointer;font-size:20px}
.lib-content{padding:12px;overflow-y:auto;min-height:0}
.lib-actions{display:flex;gap:8px;margin-bottom:10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
.card-item{border:1px solid #eee;border-radius:14px;overflow:hidden;background:#fff;display:flex;flex-direction:column}
.thumb-wrap{aspect-ratio:16/10;background:#f4f5f8;display:flex;align-items:center;justify-content:center}
.thumb-wrap img{max-width:100%;max-height:100%;display:block}
.card-body{padding:10px 12px;display:flex;gap:8px;flex-direction:column}
.badges{display:flex;gap:6px;flex-wrap:wrap}
.badge{font-size:11px;border-radius:10px;padding:4px 8px;background:#f2f3f8;color:#444}
.row-mini{display:flex;gap:6px;align-items:center}
.row-mini input{width:74px}
.actions{display:flex;gap:6px;justify-content:space-between;margin-top:8px}
.actions .btn{flex:1}

/* templates list */
.tpl-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px}
.tpl-card{border:1px solid #eee;border-radius:12px;background:#fff;padding:10px}
.tpl-title{font-weight:600;margin-bottom:6px}
.tpl-actions{display:flex;gap:6px;justify-content:flex-end;margin-top:8px}

/* Chat drawer */
.chat{position:fixed;top:0;bottom:0;left:0;width:360px;background:#fff;border-inline-end:1px solid #eee;transform:translateX(-100%);transition:.25s;z-index:70;display:flex;flex-direction:column}
.chat.open{transform:none}
.chat-head{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #eee}
.chat-log{flex:1;overflow:auto;padding:10px;display:flex;flex-direction:column;gap:8px}
.chat-msg{padding:10px;border-radius:10px;background:#f2f3f8}
.chat-msg.me{background:#dbeafe;align-self:flex-end}
.chat-input{display:flex;gap:8px;padding:10px;border-top:1px solid #eee}
.chat-input input{flex:1}
