<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>إدخال قياس</title>
  <link rel="stylesheet" href="./css/measurements.css" />
</head>
<body>

  <!-- بطاقة الإدخال -->
  <section id="measCard" class="card state-ok">
    <div id="severeBanner" class="severe-banner" hidden>
      ⚠️ تنبيه شديد — رجاء التعامل فورًا حسب الخطة المتفق عليها
    </div>

    <!-- الشيبس (تُملأ تلقائياً) -->
    <div id="chips" class="chips"></div>

    <!-- تاريخ القياس (بدون ساعة) -->
    <div class="row">
      <label>تاريخ القياس</label>
      <input type="date" id="dateInput" />
    </div>

    <!-- قيمة القياس + الوحدة -->
    <div class="row">
      <label>قيمة القياس</label>
      <select id="unitSelect" aria-label="الوحدة">
        <option value="mmol" selected>mmol/L</option>
        <option value="mgdl">mg/dL</option>
      </select>
      <input id="valueInput" type="number" step="0.1" inputmode="decimal" placeholder="مثال: 6.5" />
      <div id="convHint" class="muted">mg/dL ≈ 0</div>
    </div>

    <!-- وقت القياس (Slot) -->
    <div class="row">
      <label>وقت القياس</label>
      <select id="slotSelect" aria-label="وقت القياس">
        <option value="FASTING">الاستيقاظ</option>
        <option value="PRE_BREAKFAST">ق.الفطار</option>
        <option value="POST_BREAKFAST">ب.الفطار</option>
        <option value="PRE_LUNCH">ق.الغدا</option>
        <option value="POST_LUNCH">ب.الغدا</option>
        <option value="PRE_SPORT">ق.الرياضة</option>
        <option value="POST_SPORT">ب.الرياضة</option>
        <option value="SNACK">سناك</option>
        <option value="PRE_DINNER">ق.العشا</option>
        <option value="POST_DINNER">ب.العشا</option>
        <option value="BEDTIME">ق.النوم</option>
        <option value="OVERNIGHT">أثناء النوم</option>
        <option value="RANDOM">عشوائي</option>
      </select>
    </div>

    <!-- علاج هبوط (يظهر فقط عند Low) -->
    <div id="wrapTreatLow" class="row" hidden>
      <label>صححنا بإيه؟</label>
      <input id="treatLowInput" type="text" placeholder="مثال: 10 جم جلوكوز/عصير" />
    </div>

    <!-- حسابات الكارب/الوجبة (تظل كما هي للوجبات والسناك) -->
    <div id="wrapBolus" class="row">
      <label>رفعنا بإيه؟</label>
      <input id="carbsInput" type="number" step="1" inputmode="numeric" placeholder="جرام الكارب (اختياري)" />
      <div class="dose-group">
        <label>جرعة الوجبة</label>
        <input id="bolusDose" type="number" step="0.5" inputmode="decimal" placeholder="0" />
      </div>
    </div>

    <!-- التصحيحي (يظهر فقط عند High) -->
    <div id="wrapCorr" class="row" hidden>
      <div class="dose-group">
        <label>التصحيحي</label>
        <input id="corrDose" type="number" step="0.5" inputmode="decimal" placeholder="0" />
        <div class="muted small">يُحسب تلقائيًا بعد تجاوز حد النطاق الطبيعي الأعلى</div>
      </div>
    </div>

    <!-- الملاحظات -->
    <div class="row">
      <label>ملاحظات</label>
      <input id="notesInput" type="text" placeholder="اختياري…" />
    </div>

    <!-- شريط وضع التعديل -->
    <div id="editBar" class="editbar" hidden>
      تعديل قياس — <button id="cancelEditBtn" class="btn ghost" type="button">إلغاء</button>
    </div>

    <!-- أزرار -->
    <div class="actions">
      <button id="saveBtn" class="btn primary" type="button">حفظ</button>
      <button id="saveEditBtn" class="btn success" type="button" hidden>حفظ التعديل</button>
    </div>
  </section>

  <!-- جدول قياسات نفس اليوم المُختار -->
  <section class="table-wrap">
    <table class="table" aria-label="جدول القياسات">
      <thead>
        <tr>
          <th>التاريخ</th>
          <th>الوقت</th>
          <th>القيمة</th>
          <th>جرعة الوجبة</th>
          <th>التصحيحي</th>
          <th>ملاحظات</th>
          <th>إجراءات</th>
        </tr>
      </thead>
      <tbody id="measTableBody"></tbody>
    </table>
  </section>

  <script type="module" src="./js/measurements.js"></script>
</body>
</html>
